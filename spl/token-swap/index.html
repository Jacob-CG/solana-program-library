<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<title data-react-helmet="true">Token Swap Program | Solana Program Library Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Token Swap Program | Solana Program Library Docs"><meta data-react-helmet="true" name="description" content="A Uniswap-like exchange for the Token program on the Solana blockchain,"><meta data-react-helmet="true" property="og:description" content="A Uniswap-like exchange for the Token program on the Solana blockchain,"><meta data-react-helmet="true" property="og:url" content="https://jacob-cg.github.io//solana-program-library/spl/token-swap"><link data-react-helmet="true" rel="shortcut icon" href="/solana-program-library/spl/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://jacob-cg.github.io//solana-program-library/spl/token-swap"><link rel="stylesheet" href="/solana-program-library/spl/styles.60c563ee.css">
<link rel="preload" href="/solana-program-library/spl/styles.08b0f695.js" as="script">
<link rel="preload" href="/solana-program-library/spl/runtime~main.b775e681.js" as="script">
<link rel="preload" href="/solana-program-library/spl/main.4fc48ab9.js" as="script">
<link rel="preload" href="/solana-program-library/spl/1.1e40216e.js" as="script">
<link rel="preload" href="/solana-program-library/spl/2.c09dfc1d.js" as="script">
<link rel="preload" href="/solana-program-library/spl/22.4d569a61.js" as="script">
<link rel="preload" href="/solana-program-library/spl/20.d408417c.js" as="script">
<link rel="preload" href="/solana-program-library/spl/720ffad6.9c0d7f9c.js" as="script">
<link rel="preload" href="/solana-program-library/spl/17896441.fdadb27c.js" as="script">
<link rel="preload" href="/solana-program-library/spl/de67e391.b03287f0.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/solana-program-library/spl/"><img class="navbar__logo" src="/solana-program-library/spl/img/logo-horizontal.svg" alt="Solana Logo"></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/solana-program-library/spl/"><img class="navbar__logo" src="/solana-program-library/spl/img/logo-horizontal.svg" alt="Solana Logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp" role="complementary"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Solana Program Library (SPL)</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/token">Token Program</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/solana-program-library/spl/token-swap">Token Swap Program</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/token-lending">Token-Lending Program</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/associated-token-account">Associated Token Account Program</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/memo">Memo Program</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/name-service">Name Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/shared-memory">Shared memory Program</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/stake-pool">Stake Pool Program</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/feature-proposal">Feature Proposal Program</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Token Swap Program</h1></header><div class="markdown"><p>A Uniswap-like exchange for the Token program on the Solana blockchain,
implementing multiple automated market maker (AMM) curves.</p><p>Here is some important developer information regarding the program deployed on devnet,
testnet, and mainnet-beta:</p><table><thead><tr><th>Information</th><th>Account Address</th></tr></thead><tbody><tr><td>Token Swap Program</td><td><code>SwaPpA9LAaLfeLi3a68M4DjnLqgtticKg6CnyNwgAC8</code></td></tr><tr><td>Fee Owner</td><td><code>HfoTxFR1Tm6kGmWgYWD6J7YHVy1UwqSULUGVLXkJqaKN</code></td></tr></tbody></table><p>Check out
<a href="https://github.com/solana-labs/solana-program-library/tree/master/token-swap" target="_blank" rel="noopener noreferrer">program repository</a>
for more developer information.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="overview"></a>Overview<a aria-hidden="true" tabindex="-1" class="hash-link" href="#overview" title="Direct link to heading">#</a></h2><p>The Token Swap Program allows simple trading of token pairs without a
centralized limit order book. The program uses a mathematical formula called
&quot;curve&quot; to calculate the price of all trades.  Curves aim to mimic normal market
dynamics: for example, as traders buy a lot of one token type, the value of the
other token type goes up.</p><p>Depositors in the pool provide liquidity for the token pair. That
liquidity enables trade execution at spot price. In exchange for their
liquidity, depositors receive pool tokens, representing their fractional
ownership in the pool. During each trade, a program withholds a portion of the
input token as a fee. That fee increases the value of pool tokens by being
stored in the pool.</p><p>This program was heavily inspired by <a href="https://uniswap.org/" target="_blank" rel="noopener noreferrer">Uniswap</a> and
<a href="https://balancer.finance/" target="_blank" rel="noopener noreferrer">Balancer</a>. More information is available in their
excellent documentation and whitepapers.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="background"></a>Background<a aria-hidden="true" tabindex="-1" class="hash-link" href="#background" title="Direct link to heading">#</a></h2><p>Solana&#x27;s programming model and the definitions of the Solana terms used in this
document are available at:</p><ul><li><a href="https://docs.solana.com/apps" target="_blank" rel="noopener noreferrer">https://docs.solana.com/apps</a></li><li><a href="https://docs.solana.com/terminology" target="_blank" rel="noopener noreferrer">https://docs.solana.com/terminology</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="source"></a>Source<a aria-hidden="true" tabindex="-1" class="hash-link" href="#source" title="Direct link to heading">#</a></h2><p>The Token Swap Program&#x27;s source is available on
<a href="https://github.com/solana-labs/solana-program-library" target="_blank" rel="noopener noreferrer">github</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="interface"></a>Interface<a aria-hidden="true" tabindex="-1" class="hash-link" href="#interface" title="Direct link to heading">#</a></h2><p><a href="https://github.com/solana-labs/solana-program-library/blob/master/token-swap/js/src/index.ts">JavaScript
bindings</a>
are available that support loading the Token Swap Program on to a chain and
issuing instructions.</p><p>Example user interface built and maintained by Serum team is available
<a href="https://github.com/project-serum/oyster-swap" target="_blank" rel="noopener noreferrer">here</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="operational-overview"></a>Operational overview<a aria-hidden="true" tabindex="-1" class="hash-link" href="#operational-overview" title="Direct link to heading">#</a></h2><p>The following explains the instructions available in the Token Swap Program.
Note that each instruction has a simple code example that can be found in the
<a href="https://github.com/solana-labs/solana-program-library/blob/master/token-swap/js/cli/token-swap-test.ts">end-to-end tests</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="creating-a-new-token-swap-pool"></a>Creating a new token swap pool<a aria-hidden="true" tabindex="-1" class="hash-link" href="#creating-a-new-token-swap-pool" title="Direct link to heading">#</a></h3><p>The creation of a pool showcases the account, instruction, and authorization
models on Solana, which can be very different compared to other blockchains.</p><p>Initialization of a pool between two token types, which we&#x27;ll call &quot;A&quot;
and &quot;B&quot; for simplicity, requires the following accounts:</p><ul><li>empty pool state account</li><li>pool authority</li><li>token A account</li><li>token B account</li><li>pool token mint</li><li>pool token fee account</li><li>pool token recipient account</li><li>token program</li></ul><p>The pool state account simply needs to be created using
<code>system_instruction::create_account</code> with the correct size and enough lamports
to be rent-free.</p><p>The pool authority is a
<a href="https://docs.solana.com/developing/programming-model/calling-between-programs#program-derived-addresses" target="_blank" rel="noopener noreferrer">program derived address</a>
that can &quot;sign&quot; instructions towards other programs. This is
required for the Token Swap Program to mint pool tokens and transfer tokens from
its token A and B accounts.</p><p>The token A / B accounts, pool token mint, and pool token accounts must all be
created (using <code>system_instruction::create_account</code>) and initialized (using
<code>spl_token::instruction::initialize_mint</code> or
<code>spl_token::instruction::initialize_account</code>).  The token A and B accounts must
be funded with tokens, and their owner set to the swap authority, and the mint
must also be owned by the swap authority.</p><p>Once all of these accounts are created, the Token Swap <code>initialize</code> instruction
will properly set everything up and allow for immediate trading.  Note
that the pool state account is not required to be a signer on <code>initialize</code>,
so it&#x27;s important to perform the <code>initialize</code> instruction in the same transaction
as its <code>system_instruction::create_account</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="swapping"></a>Swapping<a aria-hidden="true" tabindex="-1" class="hash-link" href="#swapping" title="Direct link to heading">#</a></h3><p>Once a pool is created, users can immediately begin trading on it using
the <code>swap</code> instruction.  The swap instruction transfers tokens from a user&#x27;s source
account into the swap&#x27;s source token account, and then transfers tokens from
its destination token account into the user&#x27;s destination token account.</p><p>Since Solana programs require all accounts to be declared in the instruction,
users need to gather all account information from the pool state account:
the token A and B accounts, pool token mint, and fee account.</p><p>Additionally, the user must allow for tokens to be transferred from their source
token account.  The best practice is to <code>spl_token::instruction::approve</code> a
precise amount to a new throwaway Keypair, and then have that new Keypair sign
the swap transaction.  This limits the amount of tokens that can be taken
from the user&#x27;s account by the program.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="depositing-liquidity"></a>Depositing liquidity<a aria-hidden="true" tabindex="-1" class="hash-link" href="#depositing-liquidity" title="Direct link to heading">#</a></h3><p>To allow any trading, the pool needs liquidity provided from the
outside. Using the <code>deposit_all_token_types</code> or
<code>deposit_single_token_type_exact_amount_in</code> instructions, anyone can provide
liquidity for others to trade, and in exchange, depositors receive a pool token
representing fractional ownership of all A and B tokens in the pool.</p><p>Additionally, the user will need to approve a delegate to transfer tokens from
their A and B token accounts.  This limits the amount of tokens that can be taken
from the user&#x27;s account by the program.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="withdrawing-liquidity"></a>Withdrawing liquidity<a aria-hidden="true" tabindex="-1" class="hash-link" href="#withdrawing-liquidity" title="Direct link to heading">#</a></h3><p>At any time, pool token holders may redeem their pool tokens in exchange for
tokens A and B, returned at the current &quot;fair&quot; rate as determined by the curve.
In the <code>withdraw_all_token_types</code> and
<code>withdraw_single_token_type_exact_amount_out</code> instructions, pool tokens are
burned, and tokens A and B are transferred into the user&#x27;s accounts.</p><p>Additionally, the user will need to approve a delegate to transfer tokens from
their pool token account.  This limits the amount of tokens that can be taken
from the user&#x27;s account by the program.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="curves"></a>Curves<a aria-hidden="true" tabindex="-1" class="hash-link" href="#curves" title="Direct link to heading">#</a></h2><p>The Token Swap Program is completely customizable for any possible trading curve
that implements the
<a href="https://github.com/solana-labs/solana-program-library/blob/master/token-swap/program/src/curve/calculator.rs">CurveCalculator</a>
trait.  If you would like to implement a new automated market maker, it may be
as easy as forking the Token Swap Program and implementing a new curve.  The
following curves are all provided out of the box for reference.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="constant-product"></a>Constant product<a aria-hidden="true" tabindex="-1" class="hash-link" href="#constant-product" title="Direct link to heading">#</a></h3><p>The <a href="https://github.com/solana-labs/solana-program-library/blob/master/token-swap/program/src/curve/constant_product.rs">constant product
curve</a>
is the well-known Uniswap and Balancer style curve that preserves an invariant
on all swaps, expressed as the product of the quantity of token A and token B
in the swap.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">A_total * B_total = invariant</span></div></div></div></div></div><p>If a trader wishes to put in token A for some amount of token B, the calculation
for token B becomes:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(A_total + A_in) * (B_total - B_out) = invariant</span></div></div></div></div></div><p>For example, if the swap has 100 token A and 5,000 token B, and a trader wishes
to put in 10 token A, we can solve for the <code>invariant</code> and then <code>B_out</code>:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">A_total * B_total = 100 * 5,000 = 500,000 = invariant</span></div></div></div></div></div><p>And</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(A_total + A_in) * (B_total - B_out) = invariant</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(100 + 10) * (5,000 - B_out) = 500,000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">5,000 - B_out = 500,000 / 110</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">5,000 - (500,000 / 110) = B_out</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">B_out = 454.5454...</span></div></div></div></div></div><p>More information can be found on the <a href="https://uniswap.org/whitepaper.pdf">Uniswap
whitepaper</a> and the <a href="https://balancer.finance/whitepaper/" target="_blank" rel="noopener noreferrer">Balancer
whitepaper</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="constant-price"></a>Constant price<a aria-hidden="true" tabindex="-1" class="hash-link" href="#constant-price" title="Direct link to heading">#</a></h3><p>The <a href="https://github.com/solana-labs/solana-program-library/blob/master/token-swap/program/src/curve/constant_price.rs">constant price curve</a>
is a simple curve that always maintains the price of token A with respect to
token B.  At initialization, the swap creator sets the cost for 1 token B in
terms of token A. For example, if the price is set to 17, 17 token A will always
be required to receive 1 token B, and 1 token B will always be required to
receive 17 token A.</p><p>Note that this curve does not follow traditional market dynamics, since the
price is always the same.</p><p>Constant price curves are most useful for fixed offerings of new tokens that
explicitly should not have market dynamics. For example, a decentralized
game creator wants to sell new &quot;SOLGAME&quot; tokens to be used in their
game, so they create a constant price swap of 2 USDC per SOLGAME, and supply all
of the SOLGAME tokens at swap creation. Users can go to the swap and purchase all
of the tokens they want and not worry about the market making SOLGAME tokens too
expensive.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="stable-under-construction"></a>Stable (under construction)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#stable-under-construction" title="Direct link to heading">#</a></h3><p>The <a href="https://github.com/solana-labs/solana-program-library/blob/master/token-swap/program/src/curve/stable.rs">stable curve</a>
from <a href="https://www.curve.fi/" target="_blank" rel="noopener noreferrer">curve.fi</a>, has a different shape to prioritize
&quot;stable&quot; trading, meaning prices that stay constant through trading. Most
importantly, prices don&#x27;t change as quickly as the constant product curve, so a
stable swap between two coins that represent the same value should be as close
to 1:1 as possible. For example, stablecoins that represent a value in USD (USDC,
TUSD, USDT, DAI), should not have big price discrepancies due to the amount of
tokens in the swap.</p><p>The curve mirrors the dynamics of the curve
More information can be found on their <a href="https://www.curve.fi/stableswap-paper.pdf">whitepaper</a>.</p><p>The Token Swap Program implementation of the stable curve is under construction,
and a more complete version can be found at the
<a href="https://github.com/michaelhly/stable-swap-program/" target="_blank" rel="noopener noreferrer">stable-swap-program</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="offset"></a>Offset<a aria-hidden="true" tabindex="-1" class="hash-link" href="#offset" title="Direct link to heading">#</a></h3><p>The <a href="https://github.com/solana-labs/solana-program-library/blob/master/token-swap/program/src/curve/offset.rs">offset curve</a>
can be seen as a combination of the constant price and constant product curve.
It follows the constant product curve dynamics, but allows for the pool
creator to set an &quot;offset&quot; on one side. The invariant for the curve is:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(A_total) * (B_total + B_offset) = invariant</span></div></div></div></div></div><p>This is useful for initial token
offerings, where the token creator wants to sell some new token as a swap without
putting up the capital to fund the other side of the swap. This is similar to the
constant price curve, but the key difference is that the offset curve captures
normal market dynamics, in that the offered token price will increase as it is
bought.</p><p>For example, a decentralized betting application creator wants to sell new &quot;SOLBET&quot;
tokens on the market in exchange for USDC, and they believe each token is worth
at least 4 USDC.  They create a pool between SOLBET and USDC, funding
one side with 1,000 SOLBET, and the other side with 0 USDC, but an offset
of 4,000 USDC.</p><p>If a trader tries to buy SOLBET with 40 USDC, the invariant is calculated
with the offset:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(SOLBET_total) * (USDC_total + USDC_offset) = invariant</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1,000 * (0 + 4,000) = 4,000,000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(SOLBET_total - SOLBET_out) * (USDC_total + USDC_offset + USDC_in) = invariant</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SOLBET_out = 9.901</span></div></div></div></div></div><p>The trader received 9.901 SOLBET for 40 USDC, so the price per SOLBET was
roughly 4.04, slightly higher than the minimum of 4 USDC per SOLBET.</p><p>Conversely, if a trader tries to buy USDC with SOLBET immediately after creation,
it will fail because there is no USDC actually present in the pool.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="testing"></a>Testing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#testing" title="Direct link to heading">#</a></h2><p>The token-swap program is tested using various strategies, including unit tests,
integration tests, property tests, and fuzzing.  Since unit tests and integration
tests are well-known, we highlight property tests and fuzzing here.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="property-testing"></a>Property testing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#property-testing" title="Direct link to heading">#</a></h3><p>Using the <a href="https://altsysrq.github.io/proptest-book/intro.html">proptest</a>
crate, we test specific mathematical properties of curves, specifically to avoid
leaking value on any trades, deposits, or withdrawals.  It is out of scope of
this document to explain property testing, but the specific property tests for
the Token Swap Program can be found in the
<a href="https://github.com/solana-labs/solana-program-library/blob/master/token-swap/program/src/curve/constant_product.rs">curves</a>
and
<a href="https://github.com/solana-labs/solana-program-library/blob/master/token-swap/program/src/curve/math.rs">math</a>
portions of the repo.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="fuzzing"></a>Fuzzing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#fuzzing" title="Direct link to heading">#</a></h3><p>Using <a href="https://github.com/rust-fuzz/honggfuzz-rs" target="_blank" rel="noopener noreferrer">honggfuzz</a>, we regularly
test all possible inputs to the Token Swap Program, ensuring that the program
does not crash unexpectedly or leak tokens.  It is out of scope of this document
to explain fuzzing, but the specific implementation for the program can be found
in the <a href="https://github.com/solana-labs/solana-program-library/blob/master/token-swap/program/fuzz/src/instructions.rs">instruction fuzz
tests</a>
of the repo.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/solana-program-library/spl/token"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Token Program</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/solana-program-library/spl/token-lending"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Token-Lending Program »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#background" class="table-of-contents__link">Background</a></li><li><a href="#source" class="table-of-contents__link">Source</a></li><li><a href="#interface" class="table-of-contents__link">Interface</a></li><li><a href="#operational-overview" class="table-of-contents__link">Operational overview</a><ul><li><a href="#creating-a-new-token-swap-pool" class="table-of-contents__link">Creating a new token swap pool</a></li><li><a href="#swapping" class="table-of-contents__link">Swapping</a></li><li><a href="#depositing-liquidity" class="table-of-contents__link">Depositing liquidity</a></li><li><a href="#withdrawing-liquidity" class="table-of-contents__link">Withdrawing liquidity</a></li></ul></li><li><a href="#curves" class="table-of-contents__link">Curves</a><ul><li><a href="#constant-product" class="table-of-contents__link">Constant product</a></li><li><a href="#constant-price" class="table-of-contents__link">Constant price</a></li><li><a href="#stable-under-construction" class="table-of-contents__link">Stable (under construction)</a></li><li><a href="#offset" class="table-of-contents__link">Offset</a></li></ul></li><li><a href="#testing" class="table-of-contents__link">Testing</a><ul><li><a href="#property-testing" class="table-of-contents__link">Property testing</a></li><li><a href="#fuzzing" class="table-of-contents__link">Fuzzing</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://discordapp.com/invite/pquxPsq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/solana" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://forums.solana.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forums</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/solana-labs/solana-program-library" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2021 Solana Foundation</div></div></div></footer></div>
<script src="/solana-program-library/spl/styles.08b0f695.js"></script>
<script src="/solana-program-library/spl/runtime~main.b775e681.js"></script>
<script src="/solana-program-library/spl/main.4fc48ab9.js"></script>
<script src="/solana-program-library/spl/1.1e40216e.js"></script>
<script src="/solana-program-library/spl/2.c09dfc1d.js"></script>
<script src="/solana-program-library/spl/22.4d569a61.js"></script>
<script src="/solana-program-library/spl/20.d408417c.js"></script>
<script src="/solana-program-library/spl/720ffad6.9c0d7f9c.js"></script>
<script src="/solana-program-library/spl/17896441.fdadb27c.js"></script>
<script src="/solana-program-library/spl/de67e391.b03287f0.js"></script>
</body>
</html>