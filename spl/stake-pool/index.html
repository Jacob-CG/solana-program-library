<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<title data-react-helmet="true">Stake Pool Program | Solana Program Library Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://jacob-cg.github.io/solana-program-library/spl/stake-pool"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Stake Pool Program | Solana Program Library Docs"><meta data-react-helmet="true" name="description" content="A program for pooling together SOL to be staked by an off-chain agent running"><meta data-react-helmet="true" property="og:description" content="A program for pooling together SOL to be staked by an off-chain agent running"><link data-react-helmet="true" rel="shortcut icon" href="/solana-program-library/spl/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://jacob-cg.github.io/solana-program-library/spl/stake-pool"><link data-react-helmet="true" rel="alternate" href="https://jacob-cg.github.io/solana-program-library/spl/stake-pool" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://jacob-cg.github.io/solana-program-library/spl/stake-pool" hreflang="x-default"><link rel="stylesheet" href="/solana-program-library/spl/assets/css/styles.2cd238eb.css">
<link rel="preload" href="/solana-program-library/spl/assets/js/runtime~main.333d5734.js" as="script">
<link rel="preload" href="/solana-program-library/spl/assets/js/main.ddbb720a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/solana-program-library/spl/"><div class="navbar__logo"><img src="/solana-program-library/spl/img/logo-horizontal.svg" alt="Solana Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/solana-program-library/spl/img/logo-horizontal-dark.svg" alt="Solana Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div></a><a href="https://docs.solana.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Docs Â»<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://discordapp.com/invite/pquxPsq" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Chat<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/solana-labs/solana-program-library" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Solana Program Library (SPL)</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/token">Token Program</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/token-swap">Token Swap Program</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/token-lending">Token-Lending Program</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/associated-token-account">Associated Token Account Program</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/memo">Memo Program</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/name-service">Name Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/shared-memory">Shared memory Program</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/solana-program-library/spl/stake-pool">Stake Pool Program</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solana-program-library/spl/feature-proposal">Feature Proposal Program</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Stake Pool Program</h1></header><p>A program for pooling together SOL to be staked by an off-chain agent running
a Delegation Bot which redistributes the stakes across the network and tries
to maximize censorship resistance and rewards.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="overview">Overview<a aria-hidden="true" class="hash-link" href="#overview" title="Direct link to heading">â€‹</a></h2><p>SOL token holders can earn rewards and help secure the network by staking tokens
to one or more validators. Rewards for staked tokens are based on the current
inflation rate, total number of SOL staked on the network, and an individual
validatorâ€™s uptime and commission (fee).</p><p>Stake pools are an alternative method of earning staking rewards. This on-chain
program pools together SOL to be staked by a staker, allowing SOL holders to
stake and earn rewards without managing stakes.</p><p>Additional information regarding staking and stake programming is available at:</p><ul><li><a href="https://solana.com/staking" target="_blank" rel="noopener noreferrer">https://solana.com/staking</a></li><li><a href="https://docs.solana.com/staking/stake-programming" target="_blank" rel="noopener noreferrer">https://docs.solana.com/staking/stake-programming</a></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="quick-start">Quick Start<a aria-hidden="true" class="hash-link" href="#quick-start" title="Direct link to heading">â€‹</a></h2><p>If you&#x27;re looking to get immediately into creating and running a stake pool,
take a look at the
<a href="https://github.com/solana-labs/solana-program-library/tree/master/stake-pool/cli/scripts" target="_blank" rel="noopener noreferrer">reference scripts</a>.</p><p>These scripts require the Solana CLI tool suite, which can be downloaded by
following the instructions at (<a href="https://docs.solana.com/cli/install-solana-cli-tools" target="_blank" rel="noopener noreferrer">https://docs.solana.com/cli/install-solana-cli-tools</a>).
Additionally, you must have a usable keypair, created at the default location
using <code>solana-keygen new</code>.</p><p>You&#x27;ll see the following scripts:</p><ul><li><code>setup-local.sh</code>: sets up a local test validator with validator vote accounts</li><li><code>setup-stake-pool.sh</code>: creates a new stake pool with hardcoded parameters</li><li><code>deposit-withdraw.sh</code>: performs some deposits and withdrawals</li></ul><p>The
<a href="https://github.com/solana-labs/solana-program-library/tree/master/stake-pool/cli" target="_blank" rel="noopener noreferrer">CLI README</a>
contains more information about each of these scripts.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="motivation">Motivation<a aria-hidden="true" class="hash-link" href="#motivation" title="Direct link to heading">â€‹</a></h2><p>This document is intended for the main actors of the stake pool system:</p><ul><li>manager: creates and manages the stake pool, earns fees, can update the fee, staker, and manager</li><li>staker: adds and removes validators to the pool, rebalances stake among validators</li><li>user: provides staked SOL into an existing stake pool</li></ul><p>In its current iteration, the stake pool accepts active stakes or SOL, so
deposits may come from either an active stake or SOL wallet. Withdrawals
can return a fully active stake account from one of the stake pool&#x27;s accounts,
or SOL from the reserve.</p><p>This means that stake pool managers and stakers must be comfortable with
creating and delegating stakes, which are more advanced operations than sending and
receiving SPL tokens and SOL. Additional information on stake operations are
available at:</p><ul><li><a href="https://docs.solana.com/cli/delegate-stake" target="_blank" rel="noopener noreferrer">https://docs.solana.com/cli/delegate-stake</a></li><li><a href="https://docs.solana.com/cli/manage-stake-accounts" target="_blank" rel="noopener noreferrer">https://docs.solana.com/cli/manage-stake-accounts</a></li></ul><p>To reach a wider audience of users, stake pool managers are encouraged
to provide a market for their pool&#x27;s tokens, through an AMM
like <a href="/solana-program-library/spl/token-swap">Token Swap</a>.</p><p>Alternatively, stake pool managers can partner with wallet and stake account
providers for direct SOL deposits.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="operation">Operation<a aria-hidden="true" class="hash-link" href="#operation" title="Direct link to heading">â€‹</a></h2><p>A stake pool manager creates a stake pool, and the staker includes validators that will
receive delegations from the pool by adding &quot;validator stake accounts&quot; to the pool
using the <code>add-validator</code> instruction. In this command, the stake pool creates
a new stake account and delegates it to the desired validator.</p><p>At this point, users can participate with deposits. They can directly deposit
SOL into the stake pool using the <code>deposit-sol</code> instruction. Within this instruction,
the stake pool will move SOL into the pool&#x27;s reserve account, to be redistributed
by the staker.</p><p>Alternatively, users can deposit a stake account into the pool.  To do this,
they must delegate a stake account to the one of the validators in the stake pool.
If the stake pool has a preferred deposit validator, the user must delegate their
stake to that validator&#x27;s vote account.</p><p>Once the stake becomes active, which happens at the following epoch boundary
(maximum 2 days), the user can deposit their stake into the pool using the
<code>deposit-stake</code> instruction.</p><p>In exchange for their deposit (SOL or stake), the user receives SPL tokens
representing their fractional ownership in pool. A percentage of the rewards
earned by the pool goes to the pool manager as an epoch fee.</p><p>Over time, as the stakes in the pool accrue rewards, the user&#x27;s fractional
ownership will be worth more than their initial deposit.</p><p>Whenever they wish to exit the pool, the user may use the <code>withdraw-sol</code> instruction
to receive SOL from the stake pool&#x27;s reserve in exchange for stake pool tokens.
Note that this operation will fail if there is not enough SOL in the stake pool&#x27;s
reserve, which is normal if the stake pool manager stakes all of the SOL in the pool.</p><p>Alternatively, they can use the <code>withdraw-stake</code> instruction to withdraw an
activated stake account in exchange for their SPL pool tokens. The user will get
back a SOL stake account immediately. The ability to withdraw stake is always
possible, under all circumstances.</p><p>Note: when withdrawing stake, if the user wants to withdraw the SOL in the stake
account, they must first deactivate the stake account and wait until the next
epoch boundary (maximum 2 days).  Once the stake is inactive, they can freely
withdraw the SOL.</p><p>The stake pool staker can add and remove validators, or rebalance the pool by
decreasing the stake on a validator, waiting an epoch to move it into the stake
pool&#x27;s reserve account, then increasing the stake on another validator.</p><p>The staker operation to add a new validator requires 0.00328288 SOL to create
the stake account on a validator, so the stake pool staker will need liquidity
on hand to fully manage the pool stakes.  The SOL used to add a new validator
is recovered when removing the validator.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="fees">Fees<a aria-hidden="true" class="hash-link" href="#fees" title="Direct link to heading">â€‹</a></h3><p>The stake pool program provides managers many options for making the pool
financially viable, predominantly through fees. There are five different sources
of fees:</p><ul><li>Epoch: every epoch (roughly 2 days), the stake accounts in the pool earn
inflation rewards, so the stake pool mints pool tokens into the manager&#x27;s fee
account as a proportion of the earned rewards. For example, if the pool earns
10 SOL in rewards, and the fee is set to 2%, the manager will earn pool tokens
worth 0.2 SOL.</li><li>SOL withdraw: sends a proportion of the desired withdrawal amount to the manager
For example, if a user wishes to withdraw 100 pool tokens, and the fee is set
to 3%, 3 pool tokens go to the manager, and the remaining 97 tokens go to the
user in the form of a SOL.</li><li>Stake withdraw: sends a proportion of the desired withdrawal amount to the manager
before creating a new stake for the user.</li><li>SOL deposit: converts the entire SOL deposit into pool tokens, then sends a
proportion of those to the manager, and the rest to the user</li><li>Stake deposit: converts the stake account&#x27;s delegation plus rent-exemption
to pool tokens, sends a proportion of those to the manager, and the rest to
the user</li></ul><p>For partner applications, there&#x27;s the option of a referral fee on deposits.
During SOL or stake deposits, the stake pool can redistribute a percentage of
the fees to another address as a referral fee.</p><p>This option is particularly attractive for wallet providers. When a wallet
integrates a stake pool, the wallet developer will have the option to earn
additional tokens anytime a user deposits into the stake pool. Stake pool
managers can use this feature to create strategic partnerships and entice
greater adoption of stake pools!</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="funding-restrictions">Funding restrictions<a aria-hidden="true" class="hash-link" href="#funding-restrictions" title="Direct link to heading">â€‹</a></h3><p>To give the manager more control over funds entering the pool, stake pools allow
deposit and withdrawal restrictions on SOL and stakes through three different
&quot;funding authorities&quot;:</p><ul><li>SOL deposit</li><li>Stake deposit</li><li>SOL withdrawal</li></ul><p>If the field is set, that authority must sign the associated instruction.</p><p>For example, if the manager sets a stake deposit authority, then that address
must sign every stake deposit instruction.</p><p>This can also be useful in a few situations:</p><ul><li>Control who deposits into the stake pool</li><li>Prohibit a form of deposit. For example, the manager only wishes to have SOL
deposits, so they set a stake deposit authority, making it only possible to
deposit a stake account if that authority signs the transaction.</li><li>Maintenance mode. If the pool needs time to reset fees or otherwise, the
manager can temporarily restrict new deposits by setting deposit authorities.</li></ul><p>Note: in order to keep user funds safe, stake withdrawals are always permitted.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="background">Background<a aria-hidden="true" class="hash-link" href="#background" title="Direct link to heading">â€‹</a></h2><p>Solana&#x27;s programming model and the definitions of the Solana terms used in this
document are available at:</p><ul><li><a href="https://docs.solana.com/apps" target="_blank" rel="noopener noreferrer">https://docs.solana.com/apps</a></li><li><a href="https://docs.solana.com/terminology" target="_blank" rel="noopener noreferrer">https://docs.solana.com/terminology</a></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="source">Source<a aria-hidden="true" class="hash-link" href="#source" title="Direct link to heading">â€‹</a></h2><p>The Stake Pool Program&#x27;s source is available on
<a href="https://github.com/solana-labs/solana-program-library" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><p>For information about the types and instructions, the Stake Pool Rust docs are
available at <a href="https://docs.rs/spl-stake-pool/0.5.0/spl_stake_pool/" target="_blank" rel="noopener noreferrer">docs.rs</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="security-audits">Security Audits<a aria-hidden="true" class="hash-link" href="#security-audits" title="Direct link to heading">â€‹</a></h2><p>Multiple security firms have audited the stake pool program to ensure total
safety of funds. The audit reports are available for reading, presented in descending
chronological order, and the commit hash that each was reviewed at:</p><ul><li>Quantstamp<ul><li>Initial review commit hash <a href="https://github.com/solana-labs/solana-program-library/tree/99914c9fc7246b22ef04416586ab1722c89576de" target="_blank" rel="noopener noreferrer"><code>99914c9</code></a></li><li>Re-review commit hash <a href="https://github.com/solana-labs/solana-program-library/tree/3b48fa09d38d1b66ffb4fef186b606f1bc4fdb31" target="_blank" rel="noopener noreferrer"><code>3b48fa0</code></a></li><li>Final report <a href="https://solana.com/SolanaQuantstampStakePoolAudit.pdf" target="_blank" rel="noopener noreferrer">https://solana.com/SolanaQuantstampStakePoolAudit.pdf</a></li></ul></li><li>Neodyme<ul><li>Review commit hash <a href="https://github.com/solana-labs/solana-program-library/tree/0a85a9a533795b6338ea144e433893c6c0056210" target="_blank" rel="noopener noreferrer"><code>0a85a9a</code></a></li><li>Report <a href="https://solana.com/SolanaNeodymeStakePoolAudit.pdf" target="_blank" rel="noopener noreferrer">https://solana.com/SolanaNeodymeStakePoolAudit.pdf</a></li></ul></li><li>Kudelski<ul><li>Review commit hash <a href="https://github.com/solana-labs/solana-program-library/tree/3dd67672974f92d3b648bb50ee74f4747a5f8973" target="_blank" rel="noopener noreferrer"><code>3dd6767</code></a></li><li>Report <a href="https://solana.com/SolanaKudelskiStakePoolAudit.pdf" target="_blank" rel="noopener noreferrer">https://solana.com/SolanaKudelskiStakePoolAudit.pdf</a></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="command-line-utility">Command-line Utility<a aria-hidden="true" class="hash-link" href="#command-line-utility" title="Direct link to heading">â€‹</a></h2><p>The following explains the instructions available in the Stake Pool Program along
with examples using the command-line utility.</p><p>The <code>spl-stake-pool</code> command-line utility can be used to experiment with SPL
tokens.  Once you have <a href="https://rustup.rs/" target="_blank" rel="noopener noreferrer">Rust installed</a>, run:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cargo install spl-stake-pool-cli</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Run <code>spl-stake-pool --help</code> for a full description of available commands.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="configuration">Configuration<a aria-hidden="true" class="hash-link" href="#configuration" title="Direct link to heading">â€‹</a></h3><p>The <code>spl-stake-pool</code> configuration is shared with the <code>solana</code> command-line tool.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="current-configuration">Current Configuration<a aria-hidden="true" class="hash-link" href="#current-configuration" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">solana config get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Config File: ${HOME}/.config/solana/cli/config.yml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RPC URL: https://api.mainnet-beta.solana.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WebSocket URL: wss://api.mainnet-beta.solana.com/ (computed)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Keypair Path: ${HOME}/.config/solana/id.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="cluster-rpc-url">Cluster RPC URL<a aria-hidden="true" class="hash-link" href="#cluster-rpc-url" title="Direct link to heading">â€‹</a></h4><p>See <a href="https://docs.solana.com/clusters" target="_blank" rel="noopener noreferrer">Solana clusters</a> for cluster-specific RPC URLs</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">solana config set --url https://api.devnet.solana.com</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="default-keypair">Default Keypair<a aria-hidden="true" class="hash-link" href="#default-keypair" title="Direct link to heading">â€‹</a></h4><p>See <a href="https://docs.solana.com/cli/conventions#keypair-conventions" target="_blank" rel="noopener noreferrer">Keypair conventions</a>
for information on how to setup a keypair if you don&#x27;t already have one.</p><p>Keypair File</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">solana config set --keypair ${HOME}/new-keypair.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Hardware Wallet URL (See <a href="https://docs.solana.com/wallet-guide/hardware-wallets#specify-a-keypair-url" target="_blank" rel="noopener noreferrer">URL spec</a>)</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">solana config set --keypair usb://ledger/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="run-locally">Run Locally<a aria-hidden="true" class="hash-link" href="#run-locally" title="Direct link to heading">â€‹</a></h4><p>If you would like to test a stake pool locally without having to wait for stakes
to activate and deactivate, you can run the stake pool locally using the
<code>solana-test-validator</code> tool with shorter epochs, and pulling the current program
from devnet.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ solana-test-validator -c SPoo1Ku8WFXoNDMHPsrGSTSG1Y47rzgn41SLUNakuHy -c EmiU8AQkB2sswTxVB6aCmsAJftoowZGGDXuytm6X65R3 --url devnet --slots-per-epoch 32</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ solana config set --url http://127.0.0.1:8899</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="stake-pool-manager-examples">Stake Pool Manager Examples<a aria-hidden="true" class="hash-link" href="#stake-pool-manager-examples" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="create-a-stake-pool">Create a stake pool<a aria-hidden="true" class="hash-link" href="#create-a-stake-pool" title="Direct link to heading">â€‹</a></h3><p>The stake pool manager controls the stake pool from a high level, and in exchange
receives a fee in the form of SPL tokens. The manager
sets the fee on creation. Let&#x27;s create a pool with a 3% fee and a maximum of 1000
validator stake accounts:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool create-pool --epoch-fee-numerator 3 --epoch-fee-denominator 100 --max-validators 1000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating reserve stake DVwDn4LTRztuai4QeenM6fyzgiwUGpVXVNZ1mgKE1Pyc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating mint BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating associated token account DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ to receive stake pool tokens of mint BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB, owned by 4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating pool fee collection account DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: qQwqahLuC24wPwVdgVXtd7v5htSSPDAH3JxFNmXCv9aDwjjqygQ64VMg3WdPCiNzc4Bn8vtS3qcnUVHVP5MbKgL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating stake pool Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 5z6uH3EuPcujeWGpAjBtciSUR3TxtMBgWYU4ULagUso4QGzE9JenhYHwYthJ4b3rS57ByUNEXTr2BFyF5PjWC42Y</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The unique stake pool identifier is <code>Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</code>.</p><p>The identifier for the stake pool&#x27;s SPL token mint is
<code>BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</code>. The stake pool has full control
over the mint.</p><p>The pool creator&#x27;s fee account identifier is
<code>DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ</code>. Every epoch, as stake accounts
in the stake pool earn rewards, the program will mint SPL pool tokens
equal to 3% of the gains on that epoch into this account. If no gains were observed,
nothing will be deposited.</p><p>The reserve stake account identifier is <code>J5XB7mWpeaUZxZ6ogXT57qSCobczx27vLZYSgfSbZoBB</code>.
This account holds onto additional stake used when rebalancing between validators.</p><p>For a stake pool with 1000 validators, the cost to create a stake pool is less
than 0.5 SOL.</p><p>The <code>create-pool</code> command allows setting all of the accounts and keypairs to
pre-generated values, including:</p><ul><li>stake pool, through the <code>--pool-keypair</code> flag</li><li>validator list, through the <code>--validator-list-keypair</code> flag</li><li>pool token mint, through the <code>--mint-keypair</code> flag</li><li>pool reserve stake account, through the <code>--reserve-keypair</code> flag</li></ul><p>Otherwise, these will all default to newly-generated keypairs.</p><p>You can always check out the available options by running <code>spl-stake-pool create-pool -h</code>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="create-a-restricted-stake-pool">Create a restricted stake pool<a aria-hidden="true" class="hash-link" href="#create-a-restricted-stake-pool" title="Direct link to heading">â€‹</a></h3><p>If a manager would like to restrict deposits (stake and SOL) to one key in
particular, they can set a deposit authority at creation:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool create-pool --epoch-fee-numerator 3 --epoch-fee-denominator 100 --max-validators 1000 --deposit-authority authority_keypair.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating reserve stake DVwDn4LTRztuai4QeenM6fyzgiwUGpVXVNZ1mgKE1Pyc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating mint BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating associated token account DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ to receive stake pool tokens of mint BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB, owned by 4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating pool fee collection account DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: qQwqahLuC24wPwVdgVXtd7v5htSSPDAH3JxFNmXCv9aDwjjqygQ64VMg3WdPCiNzc4Bn8vtS3qcnUVHVP5MbKgL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating stake pool Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Deposits will be restricted to 4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn only, this can be changed using the set-funding-authority command.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 5z6uH3EuPcujeWGpAjBtciSUR3TxtMBgWYU4ULagUso4QGzE9JenhYHwYthJ4b3rS57ByUNEXTr2BFyF5PjWC42Y</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>As the output says, the <code>set-funding-authority</code> can be used to modify or remove
the deposit authority.</p><p>As long as the deposit authority is set, SOL and stake deposits must be signed
by <code>4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</code>, so no one else can participate
in the pool. As mentioned earlier, this feature does not prohibit withdrawals,
so anyone with pool tokens will still be able to withdraw from the pool.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="set-manager">Set manager<a aria-hidden="true" class="hash-link" href="#set-manager" title="Direct link to heading">â€‹</a></h3><p>The stake pool manager may pass their administrator privileges to another account.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool set-manager Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR --new-manager 4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 39N5gkaqXuWm6JPEUWfenKXeG4nSa71p7iHb9zurvdZcsWmbjdmSXwLVYfhAVHWucTY77sJ8SkUNpVpVAhe4eZ53</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>At the same time, they may also change the SPL token account that receives fees
every epoch. The mint for the provided token account must be the SPL token mint,
<code>BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</code> in our example.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool set-manager Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR --new-fee-receiver HoCsh97wRxRXVjtG7dyfsXSwH9VxdDzC7GvAsBE1eqJz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 4aK8yzYvPBkP4PyuXTcCm529kjEH6tTt4ixc5D5ZyCrHwc4pvxAHj6wcr4cpAE1e3LddE87J1GLD466aiifcXoAY</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="set-fee">Set fee<a aria-hidden="true" class="hash-link" href="#set-fee" title="Direct link to heading">â€‹</a></h3><p>The stake pool manager may update any of the fees associated with the stake pool,
passing the numerator and denominator for the fraction that make up the fee.</p><p>For an epoch fee of 10%, they could run:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool set-fee Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR epoch 10 100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 5yPXfVj5cbKBfZiEVi2UR5bXzVDuc2c3ruBwSjkAqpvxPHigwGHiS1mXQVE4qwok5moMWT5RNYAMvkE9bnfQ1i93</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In order to protect stake pool depositors from malicious managers, the program
applies the new fee for the following epoch.</p><p>For example, if the fee is 1% at epoch 100, and the manager sets it to 10%, the
manager will still gain 1% for the rewards earned during epoch 100. Starting
with epoch 101, the manager will earn 10%.</p><p>Additionally, to prevent a malicious manager from immediately setting the withdrawal
fee to a very high amount, making it practically impossible for users to withdraw,
the stake pool program currently enforces a limit of 1.5x increase per epoch.</p><p>For example, if the current withdrawal fee is 2.5%, the maximum that can be set
for the next epoch is 3.75%.</p><p>The possible options for the fee type are <code>epoch</code>, <code>sol-withdrawal</code>,
<code>stake-withdrawal</code>, <code>sol-deposit</code>, and <code>stake-deposit</code>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="set-referral-fee">Set referral fee<a aria-hidden="true" class="hash-link" href="#set-referral-fee" title="Direct link to heading">â€‹</a></h3><p>The stake pool manager may update the referral fee on deposits at any time, passing
in a percentage amount.</p><p>To set a stake deposit referral fee of 80%, they may run:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool set-referral-fee Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR stake 80</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 4vhaBEDhuKkVwMxy7TpyfHEk3Z5kGZKerD1AgajQBdiMRQLZuNZKVR3KQaqbUYZM7UyfRXgkZNdAeP1NfvmwKdqb</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>For 80%, this means that 20% of the stake deposit fee goes to the manager, and
80% goes to the referrer.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="set-staker">Set staker<a aria-hidden="true" class="hash-link" href="#set-staker" title="Direct link to heading">â€‹</a></h3><p>In order to manage the stake accounts, the stake pool manager or
staker can set the staker authority of the stake pool&#x27;s managed accounts.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool set-staker Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR 4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 39N5gkaqXuWm6JPEUWfenKXeG4nSa71p7iHb9zurvdZcsWmbjdmSXwLVYfhAVHWucTY77sJ8SkUNpVpVAhe4eZ53</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now, the new staker can perform any normal stake pool operations, including
adding and removing validators and rebalancing stake.</p><p>Important security note: the stake pool program only gives staking authority to
the pool staker and always retains withdraw authority. Therefore, a malicious
stake pool staker cannot steal funds from the stake pool.</p><p>Note: to avoid &quot;disturbing the manager&quot;, the staker can also reassign their stake
authority.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="set-funding-authority">Set Funding Authority<a aria-hidden="true" class="hash-link" href="#set-funding-authority" title="Direct link to heading">â€‹</a></h3><p>To restrict who can interact with the pool, the stake pool manager may require
a particular signature on stake deposits, SOL deposits, or SOL withdrawals. This
does not make the pool private, since all information is available on-chain, but
it restricts who can use the pool.</p><p>As an example, let&#x27;s say a pool wants to restrict all SOL withdrawals.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool set-funding-authority Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR sol-withdraw AZ1PgxWSxw4ezX8gvpNgGsr39jJHCwtkaXr1mNMwWWeK</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 3gx7ckGNSL7gUUyxh4CU3RH3Lyt88hiCvYQ4QRKtnmrZHvAS93ebP6bf39WYGTeKDMVSJUuwBEmk9VFSaWtXsHVV</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After running this command, <code>AZ1PgxWSxw4ezX8gvpNgGsr39jJHCwtkaXr1mNMwWWeK</code> must
sign all SOL withdrawals, otherwise the operation fails.</p><p>After some time, if the manager wishes to enable SOL withdrawals, they can remove
the restriction:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool set-funding-authority Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR sol-withdraw --unset</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 5kWeBqoxyvANMHCP4ydsZRf8QU4hMotLnKkFbTEdvqEVywo4F3MpZtay7D57FbjJZpdp72fc3vrbxJi9qDLfLCnD</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now, anyone can withdraw SOL from the stake pool, provided there is enough SOL left
in the reserve.</p><p>The options for funding authorities are <code>sol-withdraw</code>, <code>sol-deposit</code>, and <code>stake-deposit</code>.</p><p>Note: it is impossible to restrict stake withdrawals. This would create an opportunity
for malicious pool managers to effectively lock user funds.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="stake-pool-staker-examples">Stake Pool Staker Examples<a aria-hidden="true" class="hash-link" href="#stake-pool-staker-examples" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="add-a-validator-to-the-pool">Add a validator to the pool<a aria-hidden="true" class="hash-link" href="#add-a-validator-to-the-pool" title="Direct link to heading">â€‹</a></h3><p>In order to accommodate large numbers of user deposits into the stake pool, the
stake pool only manages one stake account per validator. To add a new validator
to the stake pool, the staker must use the <code>add-validator</code> command.</p><p>Let&#x27;s add some random validators to the stake pool.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool add-validator Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR 38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Adding stake account F8e8Ympp4MkDSPZdvRxdQUZXRkMBDdyqgHa363GShAPt, delegated to 38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 5tdpsx64mVcSHBK8vMbBzFDHnEZB6GUmVpqSXXE5hezMAzPYwZbJCBtAHakDAiuWNcrMongGrmwDaeywhVz4i8pi</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In order to maximize censorship resistance, we want to distribute our SOL to as
many validators as possible, so let&#x27;s add a few more.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool add-validator Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Adding stake account 5AaobwjccyHnXhFCd24uiX6VqPjXE3Ry4o92fJjqqjAr, delegated to J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 4xeve6gWuiffqBLAMcqa8s7dCMvBmSVdKbDu5WQhigLiXHdCjSNEwoZRexTZji786qgEjXg3nrUh4HcTt3RauZV5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool add-validator Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Adding stake account 3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx, delegated to EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 4VJYHpPmWkP99TdgYUTgLYixmhqmqsEkWtg4j7zvGZFjYbnLgryu48aV6ub8bqDyULzKckUhb6tvcmZmMX5AFf5G</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>We can see the status of a stake account using the Solana command-line utility.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ solana stake-account 5AaobwjccyHnXhFCd24uiX6VqPjXE3Ry4o92fJjqqjAr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Balance: 0.00328288 SOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Rent Exempt Reserve: 0.00228288 SOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Delegated Stake: 0.001 SOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Active Stake: 0 SOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Activating Stake: 0.001 SOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake activates starting from epoch: 5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Delegated Vote Account Address: J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Authority: DS3AyFN9dF1ruNBcSeo8XXQR8UyVMhcCPcnjU5GnY18S</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Withdraw Authority: DS3AyFN9dF1ruNBcSeo8XXQR8UyVMhcCPcnjU5GnY18S</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The stake pool creates these special staking accounts with 0.001 SOL as the required
minimum delegation amount. The stake and withdraw authorities are the stake pool
withdraw authority, program addresses derived from the stake pool&#x27;s address.</p><p>We can also see the status of the stake pool.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool list Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Pool: Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Pool Token Mint: BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Epoch Fee: 3/100 of epoch rewards</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Withdrawal Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Deposit Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SOL Deposit Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SOL Deposit Referral Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Deposit Referral Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Reserve Account: EN4px2h4gFkYtsQUi4yeCYBrdRM4DoRxCVJyavMXEAm5   Available Balance: â—Ž0.000000000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Vote Account: EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ      Balance: â—Ž0.000000000 Last Update Epoch: 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Vote Account: J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H      Balance: â—Ž0.000000000  Last Update Epoch: 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Vote Account: 38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk      Balance: â—Ž0.000000000  Last Update Epoch: 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total Pool Stake: â—Ž0.000000000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total Pool Tokens: 0.00000000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Current Number of Validators: 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Max Number of Validators: 1000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>To make reading easier, the tool will not show balances that cannot be touched by
the stake pool. The stake account <code>5AaobwjccyHnXhFCd24uiX6VqPjXE3Ry4o92fJjqqjAr</code>,
delegated to <code>J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</code>, actually has a balance
of 0.00328288 SOL, but since this is the minimum required amount, it is
not shown by the CLI.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="remove-validator-stake-account">Remove validator stake account<a aria-hidden="true" class="hash-link" href="#remove-validator-stake-account" title="Direct link to heading">â€‹</a></h3><p>If the stake pool staker wants to stop delegating to a vote account, they can
totally remove the validator stake account from the stake pool.</p><p>As with adding a validator, the validator stake account must have exactly
0.00328288 SOL (0.001 SOL delegated, 0.00228288 SOL for rent exemption) to be removed.</p><p>If that is not the case, the staker must first decrease the stake to that minimum amount.
Let&#x27;s assume that the validator stake account delegated to
<code>J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</code> has a total delegated amount of
7.5 SOL. To reduce that number, the staker can run:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool decrease-validator-stake Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H 6.5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: ZpQGwT85rJ8Y9afdkXhKo3TVv4xgTz741mmZj2vW7mihYseAkFsazWxza2y8eNGY4HDJm15c1cStwyiQzaM3RpH</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now, let&#x27;s try to remove validator <code>J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</code>, with
stake account <code>5AaobwjccyHnXhFCd24uiX6VqPjXE3Ry4o92fJjqqjAr</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool remove-validator Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Removing stake account 5AaobwjccyHnXhFCd24uiX6VqPjXE3Ry4o92fJjqqjAr, delegated to J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating account to receive stake nHEEyey8KkgHuVRAUDzkH5Q4PkA4veSHuTxgG6C8L2G</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 4XprnR768Ch6LUvqUVLTjMCiqdYvtjNfECh4izErqwbsASTGjUBz7NtLZHAiraTqhs7b9PoSAazetdsgXa6J4wVu</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Unlike a normal withdrawal, the validator stake account is totally moved from
the stake pool and into a new account belonging to the administrator.</p><p>Note: since removal is only possible when the validator stake is at the minimum
amount of 0.00328288, the administrator does not get any control of user funds,
and only recovers the amount contributed during <code>add-validator</code>.</p><p>The authority for the withdrawn stake account can also be specified using the
<code>--new-authority</code> flag:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool remove-validator Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H --new-authority 4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 5rrQ3xhDWyiPkUTAQkNAeq31n6sMf1xsg2x9hVY8Vj1NonwBnhxuTv87nADLkwC8Xzc4CGTNCTX2Vph9esWnXk2d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>We can check the removed stake account:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ solana stake-account nHEEyey8KkgHuVRAUDzkH5Q4PkA4veSHuTxgG6C8L2G</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Balance: 0.003282880 SOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Rent Exempt Reserve: 0.00328288 SOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Delegated Stake: 0.001000000 SOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Active Stake: 0.001000000 SOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Delegated Vote Account Address: J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Authority: 4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Withdraw Authority: 4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="rebalance-the-stake-pool">Rebalance the stake pool<a aria-hidden="true" class="hash-link" href="#rebalance-the-stake-pool" title="Direct link to heading">â€‹</a></h3><p>As time goes on, users will deposit to and withdraw from all of the stake accounts
managed by the pool, and the stake pool staker may want to rebalance the stakes.</p><p>For example, let&#x27;s say the staker wants the same delegation to every validator
in the pool. When they look at the state of the pool, they see:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool list Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Pool: Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Pool Token Mint: BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Epoch Fee: 3/100 of epoch rewards</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Withdrawal Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Deposit Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SOL Deposit Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SOL Deposit Referral Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Deposit Referral Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Reserve Account: EN4px2h4gFkYtsQUi4yeCYBrdRM4DoRxCVJyavMXEAm5   Available Balance: â—Ž10.006848640</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Vote Account: EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ      Balance: â—Ž100.000000000 Last Update Epoch: 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Vote Account: J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H      Balance: â—Ž10.000000000  Last Update Epoch: 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Vote Account: 38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk      Balance: â—Ž10.000000000  Last Update Epoch: 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total Pool Stake: â—Ž130.006848640</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total Pool Tokens: 130.00684864</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Current Number of Validators: 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Max Number of Validators: 1000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This isn&#x27;t great! The first stake account, <code>EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</code>
has too much allocated. For their strategy, the staker wants the <code>100</code>
SOL to be distributed evenly, meaning <code>40</code> in each account. They need
to move <code>30</code> to <code>J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</code> and
<code>38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</code>.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="decrease-validator-stake">Decrease validator stake<a aria-hidden="true" class="hash-link" href="#decrease-validator-stake" title="Direct link to heading">â€‹</a></h4><p>First, they need to decrease the amount on stake account
<code>3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx</code>, delegated to
<code>EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</code>, by a total of <code>60</code> SOL.</p><p>They decrease that amount of SOL:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool decrease-validator-stake Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ 60</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: ZpQGwT85rJ8Y9afdkXhKo3TVv4xgTz741mmZj2vW7mihYseAkFsazWxza2y8eNGY4HDJm15c1cStwyiQzaM3RpH</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Internally, this instruction splits and deactivates 60 SOL from the
validator stake account <code>3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx</code> into a
transient stake account, owned and managed entirely by the stake pool.</p><p>Once the stake is deactivated during the next epoch, the <code>update</code> command will
automatically merge the transient stake account into a reserve stake account,
also entirely owned and managed by the stake pool.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="increase-validator-stake">Increase validator stake<a aria-hidden="true" class="hash-link" href="#increase-validator-stake" title="Direct link to heading">â€‹</a></h4><p>Now that the reserve stake account has enough to perform the rebalance, the staker
can increase the stake on the two other validators,
<code>J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</code> and
<code>38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</code>.</p><p>They add 30 SOL to <code>J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool increase-validator-stake Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H 30</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 3GJACzjUGLPjcd9RLUW86AfBLWKapZRkxnEMc2yHT6erYtcKBgCapzyrVH6VN8Utxj7e2mtvzcigwLm6ZafXyTMw</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>And they add 30 SOL to <code>38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool increase-validator-stake Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR 38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk 30</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 4zaKYu3MQ3as8reLbuHKaXN8FNaHvpHuiZtsJeARo67UKMo6wUUoWE88Fy8N4EYQYicuwULTNffcUD3a9jY88PoU</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Internally, this instruction also uses transient stake accounts.  This time, the
stake pool splits from the reserve stake, into the transient stake account,
then activates it to the appropriate validator.</p><p>One to two epochs later, once the transient stakes activate, the <code>update</code> command
automatically merges the transient stakes into the validator stake account, leaving
a fully rebalanced stake pool:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool list Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Pool: Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Pool Token Mint: BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Preferred Deposit Validator: 38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Epoch Fee: 3/100 of epoch rewards</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Withdrawal Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Deposit Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SOL Deposit Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SOL Deposit Referral Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Deposit Referral Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Reserve Account: EN4px2h4gFkYtsQUi4yeCYBrdRM4DoRxCVJyavMXEAm5   Available Balance: â—Ž10.006848640</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Vote Account: EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ      Balance: â—Ž40.000000000  Last Update Epoch: 8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Vote Account: J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H      Balance: â—Ž40.000000000  Last Update Epoch: 8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Vote Account: 38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk      Balance: â—Ž40.000000000  Last Update Epoch: 8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total Pool Stake: â—Ž130.006848640</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total Pool Tokens: 130.00684864</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Current Number of Validators: 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Max Number of Validators: 1000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Due to staking rewards that accrued during the rebalancing process, the pool may
not perfectly balanced. This is completely normal.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="set-preferred-deposit--withdraw-validator">Set Preferred Deposit / Withdraw Validator<a aria-hidden="true" class="hash-link" href="#set-preferred-deposit--withdraw-validator" title="Direct link to heading">â€‹</a></h3><p>Since a stake pool accepts deposits to any of its stake accounts, and allows
withdrawals from any of its stake accounts, it could be used by malicious arbitrageurs
looking to maximize returns each epoch.</p><p>For example, if a stake pool has 1000 validators, an arbitrageur could stake to
any one of those validators. At the end of the epoch, they can check which
validator has the best performance, deposit their stake, and immediately withdraw
from the highest performing validator. Once rewards are paid out, they can take
their valuable stake, and deposit it back for more than they had.</p><p>To mitigate this arbitrage, a stake pool staker can set a preferred withdraw
or deposit validator. Any deposits or withdrawals must go to the corresponding
stake account, making this attack impossible without a lot of funds.</p><p>Let&#x27;s set a preferred deposit validator stake account:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool set-preferred-validator Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR deposit --vote-account EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: j6fbTqGJ8ehgKnSPns1adaSeFwg5M3wP1a32qYwZsQjymYoSejFUXLNGwvHSouJcFm4C78HUoC8xd7cvb5iActL</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>And then let&#x27;s set the preferred withdraw validator stake account to the same one:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool set-preferred-validator Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR withdraw --vote-account EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 4MKdYLyFqU6H3311YZDeLtsoeGZMzswBHyBCRjHfkzuN1rB4LXJbPfkgUGLKkdbsxJvPRub7SqB1zNPTqDdwti2w</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>At any time, they may also unset the preferred validator:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool set-preferred-validator Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR withdraw --unset</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 5Qh9FA3EXtJ7nKw7UyxmMWXnTMLRKQqcpvfEsEyBtxSPqzPAXp2vFXnPg1Pw8f37JFdvyzYay65CtA8Z1ewzVkvF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The preferred validators are marked in the <code>list</code> command:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool list Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Pool: Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Pool Token Mint: BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Preferred Deposit Validator: EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Preferred Withdraw Validator: EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="user-examples">User Examples<a aria-hidden="true" class="hash-link" href="#user-examples" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="list-validator-stake-accounts">List validator stake accounts<a aria-hidden="true" class="hash-link" href="#list-validator-stake-accounts" title="Direct link to heading">â€‹</a></h3><p>In order to deposit into the stake pool, a user must first delegate some stake
to one of the validator stake accounts associated with the stake pool. The
command-line utility has a special instruction for finding out which vote
accounts are already associated with the stake pool.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool list Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Pool: Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Pool Token Mint: BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Preferred Deposit Validator: 38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Epoch Fee: 3/100 of epoch rewards</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Withdrawal Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Deposit Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SOL Deposit Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SOL Deposit Referral Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Deposit Referral Fee: none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Reserve Account: EN4px2h4gFkYtsQUi4yeCYBrdRM4DoRxCVJyavMXEAm5   Available Balance: â—Ž10.006848640</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Vote Account: EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ      Balance: â—Ž35.000000000  Last Update Epoch: 8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Vote Account: J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H      Balance: â—Ž35.000000000  Last Update Epoch: 8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Vote Account: 38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk      Balance: â—Ž35.000000000  Last Update Epoch: 8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total Pool Stake: â—Ž115.006848640</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total Pool Tokens: 115.00684864</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Current Number of Validators: 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Max Number of Validators: 1000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="deposit-sol">Deposit SOL<a aria-hidden="true" class="hash-link" href="#deposit-sol" title="Direct link to heading">â€‹</a></h3><p>Stake pools accept SOL deposits directly from a normal SOL wallet account, and
in exchange mint the appropriate amount of pool tokens.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool deposit-sol Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR 100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Using existing associated token account DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ to receive stake pool tokens of mint BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB, owned by 4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 23CptpZaq33njCpJPAvk8XS53xXwpfqF1sGxChk3VDB5mzz7XPKQqwsreun3iwZ6b51AyHqGBaUyc6tx9fqvF9JK</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In return, the stake pool has minted us new pool tokens, representing our share
of ownership in the pool.  We can double-check our stake pool account using the
SPL token command-line utility.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-token balance BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">100.00000000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="withdraw-sol">Withdraw SOL<a aria-hidden="true" class="hash-link" href="#withdraw-sol" title="Direct link to heading">â€‹</a></h3><p>Stake pools allow SOL withdrawals directly from the reserve and into a normal
SOL wallet account, and in exchange burns the provided pool tokens.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool withdraw-sol Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR 7VXPpSxneL6JLj18Naw2gkukXtjBZfbmPh18cnoUCMD8 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 4bqZKUUrjVspqTGqGqX4zxnHnJB67WbeukKUZRmxJ2yFmr275CtHPjZNzQJD9Pe7Q6mSxnUpcVv9FUdAbGP9RyBc</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The stake pool has burned 2 pool tokens, and in return, sent SOL to
<code>7VXPpSxneL6JLj18Naw2gkukXtjBZfbmPh18cnoUCMD8</code>.</p><p>You can check that the pool tokens have been burned:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-token balance BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">98.00000000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>And you can check that the recipient has been credited:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ solana balance 7VXPpSxneL6JLj18Naw2gkukXtjBZfbmPh18cnoUCMD8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2 SOL</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="deposit-stake">Deposit stake<a aria-hidden="true" class="hash-link" href="#deposit-stake" title="Direct link to heading">â€‹</a></h3><p>Stake pools also accept deposits from active stake accounts, so we must first
create stake accounts and delegate them to one of the validators managed by the
stake pool. Using the <code>list</code> command from the previous section, we see that
<code>38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</code> is a valid vote account, so let&#x27;s
create a stake account and delegate our stake there.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ solana-keygen new --no-passphrase -o stake-account.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Generating a new keypair</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Wrote new keypair to stake-account.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">============================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pubkey: 97wBBiLVA7fUViEew8yV8R6tTdKithZDVz8LHLfF9sTJ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">============================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Save this seed phrase to recover your new keypair:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">============================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ solana create-stake-account stake-account.json 10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 5Y9r6MNoqJzVX8TWryAJbdp8i2DvintfxbYWoY6VcLEPgphK2tdydhtJTd3o3dF7QdM2Pg8sBFDZuyNcMag3nPvj</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ solana delegate-stake 97wBBiLVA7fUViEew8yV8R6tTdKithZDVz8LHLfF9sTJ 38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 2cDjHXSHjuadGQf1NQpPi43A8R19aCifsY16yTcictKPHcSAXN5TvXZ58nDJwkYs12tuZfTh5WVgAMSvptfrKdPP</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Two epochs later, when the stake is fully active and has received one epoch of
rewards, we can deposit the stake into the stake pool.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool deposit-stake Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR 97wBBiLVA7fUViEew8yV8R6tTdKithZDVz8LHLfF9sTJ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Depositing stake 97wBBiLVA7fUViEew8yV8R6tTdKithZDVz8LHLfF9sTJ into stake pool account F8e8Ympp4MkDSPZdvRxdQUZXRkMBDdyqgHa363GShAPt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Using existing associated token account DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ to receive stake pool tokens of mint BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB, owned by 4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 45x2UtA1b49eBPtRHdkvA3k8JneZzfwjptNN1kKQZaPABYiJ4hSA8qwi7qLNN5b3Fr4Z6vXhJprrTCpkk3f8UqgD</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The CLI will default to using the fee payer&#x27;s
<a href="/solana-program-library/spl/associated-token-account">Associated Token Account</a> for stake pool tokens
and the withdraw authority on the deposited stake account.</p><p>Alternatively, you can create an SPL token account yourself and pass it as the
<code>token-receiver</code> for the command, and specify the withdraw authority on the
stake account using the <code>withdraw-authority</code> flag.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool deposit-stake Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR 97wBBiLVA7fUViEew8yV8R6tTdKithZDVz8LHLfF9sTJ --token-receiver 34XMHa3JUPv46ftU4dGHvemZ9oKVjnciRePYMcX3rjEF --withdraw-authority authority.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Depositing stake 97wBBiLVA7fUViEew8yV8R6tTdKithZDVz8LHLfF9sTJ into stake pool account F8e8Ympp4MkDSPZdvRxdQUZXRkMBDdyqgHa363GShAPt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 4AESGZzqBVfj5xQnMiPWAwzJnAtQDRFK1Ha6jqKKTs46Zm5fw3LqgU1mRAT6CKTywVfFMHZCLm1hcQNScSMwVvjQ</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In return, the stake pool has minted us new pool tokens, representing our share
of ownership in the pool.  We can double-check our stake pool account using the
SPL token command-line utility.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-token balance BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10.00000000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="note-on-stake-deposit-fee">Note on stake deposit fee<a aria-hidden="true" class="hash-link" href="#note-on-stake-deposit-fee" title="Direct link to heading">â€‹</a></h4><p>Stake pools have separate fees for stake and SOL, so the total fee from depositing
a stake account is calculated from the rent-exempt reserve as SOL, and the delegation
as stake.</p><p>For example, if a stake pool has a stake deposit fee of 1%, and a SOL deposit fee
of 5%, and you deposit a stake account with 10 SOL in stake, and .00228288 SOL
in rent-exemption, the total fee charged is:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">total_fee = stake_delegation * stake_deposit_fee + rent_exemption * sol_deposit_fee</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">total_fee = 10 * 1% + .00228288 * 5%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">total_fee = 0.100114144</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="update">Update<a aria-hidden="true" class="hash-link" href="#update" title="Direct link to heading">â€‹</a></h3><p>Every epoch, the network pays out rewards to stake accounts managed by the stake
pool, increasing the value of pool tokens minted on deposit.
In order to calculate the proper value of these stake pool tokens, we must update
the total value managed by the stake pool every epoch.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool update Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 2rtPNGKFSSnXFCb6MKG5wHp34dkB5hJWNhro8EU2oGh1USafAgzu98EgoRnPLi7ojQfmTpvXk4S7DWXYGu5t85Ka</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 5V2oCNvZCNJfC6QXHmR2UHGxVMip6nfZixYkVjFQBTyTf2Z9s9GJ9BjkxSFGvUsvW6zc2cCRv9Lqucu1cgHMFcVU</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If another user already updated the stake pool balance for the current epoch, we
see a different output.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool update Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Update not required</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If no one updates the stake pool in the current epoch, all instructions, including
deposit and withdraw, will fail. The update instruction is permissionless, so any user
can run it before interacting with the pool. As a convenience, the CLI attempts
to update before running any instruction on the stake pool.</p><p>If the stake pool transient stakes are in an unexpected state, and merges are
not possible, there is the option to only update the stake pool balances without
performing merges using the <code>--no-merge</code> flag.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool update Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR --no-merge</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 5cjdZG727uzwnEEG3vJ1vskA9WsXibaEHh7imXSb2S1cwEYK4Q3btr2GEeAV8EffK4CEQ2WM6PQxawkJAHoZ4jsQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: EBHbSRstJ3HxKwYKak8vEwVMKr1UBxdbqs5KuX3XYt4ppPjhaziGEtvL2TJCm1HLokbrtMeTEv57Ef4xhByJtJP</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Later on, whenever the transient stakes are ready to be merged, it is possible to
force another update in the same epoch using the <code>--force</code> flag.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool update Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR --force</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 5RneEBwJkFytBJaJdkvCTHFrG3QzE3SGf9vdBm9gteCcHV4HwaHzj3mjX1hZg4yCREQSgmo3H9bPF6auMmMFTSTo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 1215wJUY7vj82TQoGCacQ2VJZ157HnCTvfsUXkYph3nZzJNmeDaGmy1nCD7hkhFfxnQYYxVtec5TkDFGGB4e7EvG</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="withdraw-stake">Withdraw stake<a aria-hidden="true" class="hash-link" href="#withdraw-stake" title="Direct link to heading">â€‹</a></h3><p>Whenever the user wants to recover their SOL plus accrued rewards, they can provide their
pool tokens in exchange for an activated stake account.</p><p>Let&#x27;s withdraw active staked SOL in exchange for 5 pool tokens.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool withdraw-stake Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR 5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Withdrawing â—Ž5.000000000, or 5 pool tokens, from stake account 3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx, delegated to EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating account to receive stake 5GuAyPAt6577HoGhSVRNBv6aHohVtjQ8q7q5i3X1p4tB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 5fzaKt5MU8bLjJRgNZyEktKsgweSQzFRpubCGKPeuk9shNQb4CtTkbgZ2X5MmC1VRDZ3YcCTPdtL9sFpXYfoqaeV</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The stake pool took 5 pool tokens, and in exchange the user received a fully
active stake account, delegated to <code>EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</code>.
Let&#x27;s double-check the status of the stake account:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ solana stake-account 5GuAyPAt6577HoGhSVRNBv6aHohVtjQ8q7q5i3X1p4tB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Balance: 5.00228288 SOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Rent Exempt Reserve: 0.00228288 SOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Delegated Stake: 5 SOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Active Stake: 5 SOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Delegated Vote Account Address: EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stake Authority: 4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Withdraw Authority: 4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Note: this operation cost the user some funds, as they needed to create a new
stake account with the minimum rent exemption in order to receive the funds. This
allows the user to withdraw any amount of stake pool tokens, even if it is not
enough to cover the stake account rent-exemption.</p><p>Alternatively, the user can specify an existing uninitialized stake account to
receive their stake using the <code>--stake-receiver</code> parameter.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool withdraw-stake Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR  --amount 0.02 --vote-account EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ --stake-receiver CZF2z3JJoDmJRcVjtsrz1BKUUGNL3VPW5FPFqge1bzmQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Withdrawing â—Ž5.000000000, or 5 pool tokens, from stake account 3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx, delegated to EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 2xBPVPJ749AE4hHNCNYdjuHv1EdMvxm9uvvraWfTA7Urrvecwh9w64URCyLLroLQ2RKDGE2QELM2ZHd8qRkjavJM</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>By default, the withdraw command uses the <code>token-owner</code>&#x27;s associated token account to
source the pool tokens. It&#x27;s possible to specify the SPL token account using
the <code>--pool-account</code> flag.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool withdraw-stake Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR 5 --pool-account 34XMHa3JUPv46ftU4dGHvemZ9oKVjnciRePYMcX3rjEF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Withdrawing â—Ž5.000000000, or 5 pool tokens, from stake account 3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx, delegated to EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating account to receive stake CZF2z3JJoDmJRcVjtsrz1BKUUGNL3VPW5FPFqge1bzmQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 2xBPVPJ749AE4hHNCNYdjuHv1EdMvxm9uvvraWfTA7Urrvecwh9w64URCyLLroLQ2RKDGE2QELM2ZHd8qRkjavJM</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>By default, the withdraw command will withdraw from the largest validator stake
accounts in the pool. It&#x27;s also possible to specify a specific vote account for
the withdraw using the <code>--vote-account</code> flag.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool withdraw-stake Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR  --amount 5 --vote-account EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Withdrawing â—Ž5.000000000, or 5 pool tokens, from stake account 3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx, delegated to EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating account to receive stake CZF2z3JJoDmJRcVjtsrz1BKUUGNL3VPW5FPFqge1bzmQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: 2xBPVPJ749AE4hHNCNYdjuHv1EdMvxm9uvvraWfTA7Urrvecwh9w64URCyLLroLQ2RKDGE2QELM2ZHd8qRkjavJM</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Note that the associated validator stake account must have enough lamports to
satisfy the pool token amount requested.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="special-case-exiting-pool-with-a-delinquent-staker">Special case: exiting pool with a delinquent staker<a aria-hidden="true" class="hash-link" href="#special-case-exiting-pool-with-a-delinquent-staker" title="Direct link to heading">â€‹</a></h4><p>With the reserve stake, it&#x27;s possible for a delinquent or malicious staker to
move all stake into the reserve through <code>decrease-validator-stake</code>, so the
pool tokens will not gain rewards, and the stake pool users will not
be able to withdraw their funds.</p><p>To get around this case, it is also possible to withdraw from the stake pool&#x27;s
reserve, but only if all of the validator stake accounts are at the minimum amount of
<code>0.001 SOL + stake account rent exemption</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ spl-stake-pool withdraw-stake Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR 5 --use-reserve</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Withdrawing â—Ž5.000000000, or 5 pool tokens, from stake account J5XB7mWpeaUZxZ6ogXT57qSCobczx27vLZYSgfSbZoBB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Creating account to receive stake 51XdXiBSsVzeuY79xJwWAGZgeKzzgFKWajkwvWyrRiNE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Signature: yQH9n7Go6iCMEYXqWef38ZYBPwXDmbwKAJFJ4EHD6TusBpusKsfNuT3TV9TL8FmxR2N9ExZTZwbD9Njc3rMvUcf</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="appendix">Appendix<a aria-hidden="true" class="hash-link" href="#appendix" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="activated-stakes">Activated stakes<a aria-hidden="true" class="hash-link" href="#activated-stakes" title="Direct link to heading">â€‹</a></h3><p>As mentioned earlier, the stake pool only processes active stakes. This feature
maintains fungibility of stake pool tokens. Fully activated stakes
are not equivalent to inactive, activating, or deactivating stakes due to the
time cost of staking. Otherwise, malicious actors can deposit stake in one state
and withdraw it in another state without waiting.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="transient-stake-accounts">Transient stake accounts<a aria-hidden="true" class="hash-link" href="#transient-stake-accounts" title="Direct link to heading">â€‹</a></h3><p>Each validator gets one transient stake account, so the staker can only
perform one action at a time on a validator. It&#x27;s impossible to increase
and decrease the stake on a validator at the same time. The staker must wait for
the existing transient stake account to get merged during an <code>update</code> instruction
before performing a new action.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="reserve-stake-account">Reserve stake account<a aria-hidden="true" class="hash-link" href="#reserve-stake-account" title="Direct link to heading">â€‹</a></h3><p>Every stake pool is initialized with an undelegated reserve stake account, used
to hold undelegated stake in process of rebalancing. After the staker decreases
the stake on a validator, one epoch later, the update operation will merge the
decreased stake into the reserve. Conversely, whenever the staker increases the
stake on a validator, the lamports are drawn from the reserve stake account.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="safety-of-funds">Safety of Funds<a aria-hidden="true" class="hash-link" href="#safety-of-funds" title="Direct link to heading">â€‹</a></h3><p>One of the primary aims of the stake pool program is to always allow pool token
holders to withdraw their funds at any time.</p><p>To that end, let&#x27;s look at the three classes of stake accounts in the stake pool system:</p><ul><li>validator stake: active stake accounts, one per validator in the pool</li><li>transient stake: activating or deactivating stake accounts, merged into the reserve after deactivation, or into the validator stake after activation, one per validator</li><li>reserve stake: inactive stake, to be used by the staker for rebalancing</li></ul><p>Additionally, the staker may set a &quot;preferred withdraw account&quot;, which forces users
to withdraw from a particular stake account.  This is to prevent malicious
depositors from using the stake pool as a free conversion between validators.</p><p>When processing withdrawals, the order of priority goes:</p><ul><li>preferred withdraw validator stake account (if set)</li><li>validator stake accounts</li><li>transient stake accounts</li><li>reserve stake account</li></ul><p>If there is preferred withdraw validator, and that validator stake account has
any SOL, a user must withdraw from that account.</p><p>If that account is empty, or the preferred withdraw validator stake account is
not set, then the user must withdraw from any validator stake account.</p><p>If all validator stake accounts are empty, which may happen if the stake pool
staker decreases the stake on all validators at once, then the user must withdraw
from any transient stake account.</p><p>If all transient stake accounts are empty, then the user must withdraw from the
reserve.</p><p>In this way, a user&#x27;s funds are never at risk, and always redeemable.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="transaction-sizes">Transaction sizes<a aria-hidden="true" class="hash-link" href="#transaction-sizes" title="Direct link to heading">â€‹</a></h3><p>The Solana transaction processor has two important limitations:</p><ul><li>size of the overall transaction, limited to roughly 1 MTU / packet</li><li>computation budget per instruction</li></ul><p>A stake pool may manage hundreds of staking accounts, so it is impossible to
update the total value of the stake pool in one instruction. Thankfully, the
command-line utility breaks up transactions to avoid this issue for large pools.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/solana-program-library/spl/shared-memory"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Shared memory Program</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/solana-program-library/spl/feature-proposal"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Feature Proposal Program<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#quick-start" class="table-of-contents__link toc-highlight">Quick Start</a></li><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#operation" class="table-of-contents__link toc-highlight">Operation</a><ul><li><a href="#fees" class="table-of-contents__link toc-highlight">Fees</a></li><li><a href="#funding-restrictions" class="table-of-contents__link toc-highlight">Funding restrictions</a></li></ul></li><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#source" class="table-of-contents__link toc-highlight">Source</a></li><li><a href="#security-audits" class="table-of-contents__link toc-highlight">Security Audits</a></li><li><a href="#command-line-utility" class="table-of-contents__link toc-highlight">Command-line Utility</a><ul><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li></ul></li><li><a href="#stake-pool-manager-examples" class="table-of-contents__link toc-highlight">Stake Pool Manager Examples</a><ul><li><a href="#create-a-stake-pool" class="table-of-contents__link toc-highlight">Create a stake pool</a></li><li><a href="#create-a-restricted-stake-pool" class="table-of-contents__link toc-highlight">Create a restricted stake pool</a></li><li><a href="#set-manager" class="table-of-contents__link toc-highlight">Set manager</a></li><li><a href="#set-fee" class="table-of-contents__link toc-highlight">Set fee</a></li><li><a href="#set-referral-fee" class="table-of-contents__link toc-highlight">Set referral fee</a></li><li><a href="#set-staker" class="table-of-contents__link toc-highlight">Set staker</a></li><li><a href="#set-funding-authority" class="table-of-contents__link toc-highlight">Set Funding Authority</a></li></ul></li><li><a href="#stake-pool-staker-examples" class="table-of-contents__link toc-highlight">Stake Pool Staker Examples</a><ul><li><a href="#add-a-validator-to-the-pool" class="table-of-contents__link toc-highlight">Add a validator to the pool</a></li><li><a href="#remove-validator-stake-account" class="table-of-contents__link toc-highlight">Remove validator stake account</a></li><li><a href="#rebalance-the-stake-pool" class="table-of-contents__link toc-highlight">Rebalance the stake pool</a></li><li><a href="#set-preferred-deposit--withdraw-validator" class="table-of-contents__link toc-highlight">Set Preferred Deposit / Withdraw Validator</a></li></ul></li><li><a href="#user-examples" class="table-of-contents__link toc-highlight">User Examples</a><ul><li><a href="#list-validator-stake-accounts" class="table-of-contents__link toc-highlight">List validator stake accounts</a></li><li><a href="#deposit-sol" class="table-of-contents__link toc-highlight">Deposit SOL</a></li><li><a href="#withdraw-sol" class="table-of-contents__link toc-highlight">Withdraw SOL</a></li><li><a href="#deposit-stake" class="table-of-contents__link toc-highlight">Deposit stake</a></li><li><a href="#update" class="table-of-contents__link toc-highlight">Update</a></li><li><a href="#withdraw-stake" class="table-of-contents__link toc-highlight">Withdraw stake</a></li></ul></li><li><a href="#appendix" class="table-of-contents__link toc-highlight">Appendix</a><ul><li><a href="#activated-stakes" class="table-of-contents__link toc-highlight">Activated stakes</a></li><li><a href="#transient-stake-accounts" class="table-of-contents__link toc-highlight">Transient stake accounts</a></li><li><a href="#reserve-stake-account" class="table-of-contents__link toc-highlight">Reserve stake account</a></li><li><a href="#safety-of-funds" class="table-of-contents__link toc-highlight">Safety of Funds</a></li><li><a href="#transaction-sizes" class="table-of-contents__link toc-highlight">Transaction sizes</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discordapp.com/invite/pquxPsq" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/solana" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://forums.solana.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/solana-labs/solana-program-library" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Solana Foundation</div></div></div></footer></div>
<script src="/solana-program-library/spl/assets/js/runtime~main.333d5734.js"></script>
<script src="/solana-program-library/spl/assets/js/main.ddbb720a.js"></script>
</body>
</html>